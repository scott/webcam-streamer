name: webcam-streamer
region: nyc

# Each stream is a separate service
# Each service runs its own container with its own config

services:
  # Stream 1: Ski Resort
  - name: stream-ski-resort
    github:
      branch: master
      repo: scott/webcam-streamer
    dockerfile_path: Dockerfile
    source_dir: /
    run_command: python stream_manager.py --config configs/streams/ski-resort.yaml
    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-s
    health_check:
      path: /health
      port: 8080
      initial_delay_seconds: 10
      period_seconds: 5
      timeout_seconds: 3
      failure_threshold: 10
    envs:
      - key: YOUTUBE_KEY_SKI_RESORT
        type: SECRET
        value: ${YOUTUBE_KEY_SKI_RESORT}
      - key: YOUTUBE_API_KEY
        type: SECRET
        value: ${YOUTUBE_API_KEY}

  # Stream 2: Example (uncomment and configure to add more streams)
  # - name: stream-example
  #   github:
  #     branch: master
  #     repo: scott/webcam-streamer
  #   build_command: pip install -r requirements.txt
  #   run_command: python stream_manager.py --config configs/streams/example.yaml
  #   http_port: 8080
  #   instance_count: 1
  #   instance_size_slug: basic-xxs
  #   env:
  #     - key: YOUTUBE_KEY_EXAMPLE
  #       type: SECRET
  #       value: ${YOUTUBE_KEY_EXAMPLE}

# How to add a new stream:
# 1. Create config file: configs/streams/new-stream.yaml
# 2. Add environment variable in DO dashboard: YOUTUBE_KEY_NEWSTREAM
# 3. Copy a service block above and modify:
#    - name: stream-new-stream
#    - run_command: --config configs/streams/new-stream.yaml
#    - env key: YOUTUBE_KEY_NEWSTREAM
# 4. Redeploy
